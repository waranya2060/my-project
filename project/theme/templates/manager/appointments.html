{% extends "base3.html" %}

{% block title %}นัดหมายการสอบโครงงาน{% endblock %}

{% block header %}นัดหมาย{% endblock %}

{% block content %}
<div class="bg-white shadow-md rounded-lg p-6">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">สร้างการนัดหมาย</h2>

    <form method="POST">
        {% csrf_token %}
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ส่วนซ้าย -->
            <div>
                <!-- เลือกอาจารย์ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">อาจารย์ที่เข้าร่วม <span class="text-red-500">*</span></label>
                    <div class="mb-2 flex items-center">
                        <input type="checkbox" id="select-all-teachers" class="mr-2">
                        <label for="select-all-teachers" class="text-sm font-medium">เลือกอาจารย์ทั้งหมด</label>
                    </div>
                    <div class="border rounded-md p-3 max-h-40 overflow-y-auto bg-gray-50">
                        {% for teacher in teachers %}
                        <div class="flex items-center mb-2">
                            <input type="checkbox" name="teachers" value="{{ teacher.id }}" id="teacher-{{ teacher.id }}" class="mr-2 teacher-checkbox">
                            <label for="teacher-{{ teacher.id }}" class="text-sm">
                                {{ teacher.get_full_name }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- เลือกนักศึกษา -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">นักศึกษาที่เข้าร่วม <span class="text-red-500">*</span></label>
                    <div class="mb-2 flex items-center">
                        <input type="checkbox" id="select-all-students" class="mr-2">
                        <label for="select-all-students" class="text-sm font-medium">เลือกนักศึกษาทั้งหมด</label>
                    </div>
                    <div class="border rounded-md p-3 max-h-40 overflow-y-auto bg-gray-50">
                        {% for student in students %}
                        <div class="flex items-center mb-2">
                            <input type="checkbox" name="students" value="{{ student.id }}" id="student-{{ student.id }}" class="mr-2 student-checkbox">
                            <label for="student-{{ student.id }}" class="text-sm">
                                {% if student.student %}{{ student.student.student_id }} - {% endif %}{{ student.get_full_name }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- ส่วนขวา -->
            <div>
                <!-- หัวข้อการนัดหมาย -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">หัวข้อการนัดหมาย <span class="text-red-500">*</span></label>
                    <input type="text" name="topic" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2" placeholder="เช่น สอบหัวข้อโครงงาน, สอบก้าวหน้า, สอบปิดเล่ม" required>
                </div>

                <!-- เลือกวันเวลา -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">วันที่ <span class="text-red-500">*</span></label>
                    {{ form.date }}
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">เวลาเริ่ม <span class="text-red-500">*</span></label>
                        {{ form.time_start }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">เวลาสิ้นสุด <span class="text-red-500">*</span></label>
                        {{ form.time_finish }}
                    </div>
                </div>

             <!-- สถานที่ -->
<div class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">สถานที่ (ไม่บังคับ)</label>
    {{ form.location }}
</div>

<!-- ลิงก์การประชุมออนไลน์ -->
<div class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">ลิงก์การประชุมออนไลน์ (ไม่บังคับ)</label>
    {{ form.meeting_link }}
</div>
            </div>
        </div>

     

        <!-- ปุ่มบันทึก -->
        <div class="mt-6 flex justify-end">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md transition duration-300">
                บันทึกการนัดหมาย
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // การตั้งค่าสำหรับฟอร์ม
        {% if form.time_start.value %}
            document.querySelector('#id_time_start').value = '{{ form.time_start.value|time:"H:i" }}';
        {% endif %}
        
        {% if form.time_finish.value %}
            document.querySelector('#id_time_finish').value = '{{ form.time_finish.value|time:"H:i" }}';
        {% endif %}
        
        // CSS สำหรับฟอร์ม
        const formInputs = document.querySelectorAll('input[type="date"], input[type="time"], input[type="text"], input[type="url"], select');
        formInputs.forEach(input => {
            input.classList.add('mt-1', 'block', 'w-full', 'rounded-md', 'border-gray-300', 'shadow-sm', 'focus:border-blue-500', 'focus:ring', 'focus:ring-blue-500', 'focus:ring-opacity-50', 'p-2');
        });

        // ฟังก์ชันเลือกทั้งหมด - อาจารย์
        const selectAllTeachers = document.getElementById('select-all-teachers');
        const teacherCheckboxes = document.querySelectorAll('.teacher-checkbox');
        
        selectAllTeachers.addEventListener('change', function() {
            teacherCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });

        // ฟังก์ชันเลือกทั้งหมด - นักศึกษา
        const selectAllStudents = document.getElementById('select-all-students');
        const studentCheckboxes = document.querySelectorAll('.student-checkbox');
        
        selectAllStudents.addEventListener('change', function() {
            studentCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    });
</script>
{% endblock %}